@using JsonEverythingNet.Services

<div class="mx-3 navbar">
	<div class="container-fluid">
		<div class="align-items-center">
			<a class="navbar-brand font-monospace" href="">
				<img src="img/json-animated.webp" height="50" alt="json-everything" />
				json-everything
			</a>
		</div>
		<div class="px-1">
			<button class="navbar-brand m-2 btn btn-link p-0" @onclick="ToggleTheme" style="border: none; background: none; outline: none; box-shadow: none;">
				<span class="tooltip-icon">
					<i class="material-icons" style="color: white;">
						@if (_isDarkMode)
						{
							<text>lightbulb_outline</text>
						}
						else
						{
							<text>lightbulb</text>
						}
					</i>
					<span class="tooltip-text header-tooltip" style="top: 25px; padding: 10px; min-width: auto;">
						Turn the lights @(_isDarkMode ? "on" : "off")
					</span>
				</span>
			</button>
			<a class="navbar-brand m-2" href="https://blog.json-everything.net">
				<span class="tooltip-icon">
					blog
					<span class="tooltip-text header-tooltip">
						<MarkdownSpan Content="@HelpContent.BlogPromo"></MarkdownSpan>
					</span>
				</span>
			</a>
			<a class="navbar-brand m-2" href="https://docs.json-everything.net">
				<span class="tooltip-icon">
					docs
					<span class="tooltip-text header-tooltip">
						<MarkdownSpan Content="@HelpContent.DocsPromo"></MarkdownSpan>
					</span>
				</span>
			</a>
			<a class="navbar-brand m-2" href="https://learn.json-everything.net">
				<span class="tooltip-icon">
					learn
					<span class="tooltip-text header-tooltip">
						<MarkdownSpan Content="@HelpContent.LearnPromo"></MarkdownSpan>
					</span>
				</span>
			</a>
			<a href="@Redirects.Slack" class="navbar-brand m-2" target="_blank">
				<span class="tooltip-icon">
					<img src="img/slack.png" alt="Discuss in Slack" />
					<span class="tooltip-text header-tooltip">
						<MarkdownSpan Content="Discuss in Slack"></MarkdownSpan>
					</span>
				</span>
			</a>
			<a href="@Redirects.Github" class="navbar-brand m-2" target="_blank">
				<span class="tooltip-icon">
					<img src="img/github.png" alt="View on GitHub" />
					<span class="tooltip-text header-tooltip">
						<MarkdownSpan Content="View on GitHub"></MarkdownSpan>
					</span>
				</span>
			</a>
		</div>
	</div>
</div>

@inject DataManager DataManager
@inject IJSRuntime JSRuntime
@inject ThemeService ThemeService

@code {
	private bool _isDarkMode = false;

	protected override async Task OnAfterRenderAsync(bool firstRender)
	{
		if (firstRender)
		{
			var theme = await DataManager.Get("theme");
			_isDarkMode = theme != "light"; // default to dark mode
			ThemeService.SetTheme(_isDarkMode);
			await ApplyTheme();
			StateHasChanged();
		}
	}

	private async Task ToggleTheme()
	{
		_isDarkMode = !_isDarkMode;
		ThemeService.SetTheme(_isDarkMode);
		await ApplyTheme();
		await DataManager.Set("theme", _isDarkMode ? "dark" : "light");
	}

	private async Task ApplyTheme()
	{
		await JSRuntime.InvokeVoidAsync("eval", _isDarkMode 
			? "document.documentElement.removeAttribute('data-bs-theme')" 
			: "document.documentElement.setAttribute('data-bs-theme', 'light')");
	}
}
